#!/usr/bin/perl
use strict;

use JSON;
use LWP::UserAgent;

my ($siteUrl, $project) = @ARGV;

&usage unless $siteUrl && $project;

my $recordTypes = { '' => "", };

my $ssUrl = "$siteUrl/site-search";
my $jsonString = "{\"searchText\":\"*\",\"pagination\":{\"offset\":0,\"numRecords\":0},\"restrictToProject\":\"$project\"}";

my $ua = LWP::UserAgent->new;
my $req = HTTP::Request->new(POST => $ssUrl);
$req->header( 'Content-Type' => 'application/json' );
$req->content($jsonString);
my $res = $ua->request($req);

# Check the outcome of the response
if (!$res->is_success) {
    print "ERROR: ", $res->status_line, "\n";
}

my $ssResults = from_json($res->content);

print $ssResults->{documentTypes}->[0]->{displayName};

sub usage() {
  die "
Test the wdk records installed in an apicommon website's site search by comparing against the WDK records found by querying the WDK

Usage: testApiCommonWdkRecords website_url project

Example: testApiCommonWdkRecords https://qa.plasmodb.org PlasmoDB

";
}

