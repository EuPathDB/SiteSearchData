<wdkModel>

  <querySet name="CompoundIdQueries" queryType="id" isCacheable="true">

    <sqlQuery name="AllCompounds">
      <column name="source_id"/>
      <sql>
        <![CDATA[
            select source_id
            from apidbTuning.CompoundAttributes
        ]]>
      </sql>
    </sqlQuery>
  </querySet>

  <querySet name="CompoundAttributes" queryType="attribute" isCacheable="false">

    <sqlQuery name="CompoundAlias" doNotTest="true">
      <column name="source_id"/>
      <column name="old_source_id"/>
      <sql>
        <![CDATA[
          select source_id, source_id as old_source_id
          from apidbTuning.CompoundAttributes
        ]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="Bfmv">
      <column name="source_id"/>
      <column name="project"/>
      <column name="compound_name"/>
      <column name="other_names"/>
      <column name="definition"/>
      <column name="formula"/>
      <column name="secondary_ids"/>
      <sql>
        <![CDATA[
          select source_id, compound_name, definition, secondary_ids,
                 other_names, formula, '@PROJECT_ID@' as project
          from apidbTuning.CompoundAttributes
        ]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="Synonyms">
      <column name="source_id"/>
      <column name="synonyms"/>
      <sql>
        <![CDATA[
          select ca.source_id,
                 apidb.tab_to_string(set(cast(collect(n.name) as apidb.varchartab)),', ') as synonyms
          from apidbTuning.CompoundAttributes ca, chebi.names n
          where ca.id = n.compound_id(+)
          group by ca.source_id
        ]]>
      </sql>
    </sqlQuery>

  </querySet>

  <querySet name="CompoundTables" queryType="table" isCacheable="false">

    <sqlQuery name="Properties">
      <column name="source_id"/>
      <column name="value"/>
      <sql>
        <![CDATA[
            select ca.source_id, struct.type, to_char(struct.structure) as value
            from apidbTuning.CompoundAttributes ca, chebi.Structures struct
            where ca.id = struct.compound_id
              and struct.dimension = '1D'
          union
            select ca.source_id, cd.type,
                   case
                     when cd.type='FORMULA'
                       then REGEXP_REPLACE(cd.chemical_data,'(\d)','<sub>\1</sub>')
                     else chemical_data
                   end as value
            from apidbTuning.CompoundAttributes ca, chebi.chemical_data cd
            where ca.id = cd.compound_id
        ]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="IupacNames">
      <column name="source_id"/>
      <column name="value"/>
      <sql>
        <![CDATA[
          select ca.source_id, n.name as value
          from apidbTuning.CompoundAttributes ca, chebi.names n
          where ca.id = n.compound_id
            and n.type='IUPAC NAME'
        ]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="Definition">
      <column name="source_id"/>
      <column name="definition"/>
      <sql>
        <![CDATA[
          select source_id, definition
          from apidbTuning.CompoundAttributes
        ]]>
      </sql>
    </sqlQuery>


    <sqlQuery name="SecondaryIds">
      <column name="source_id"/>
      <column name="secondary_ids"/>
      <sql>
        <![CDATA[
          select source_id, secondary_ids
          from apidbTuning.CompoundAttributes
        ]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="Synonyms">
      <column name="source_id"/>
      <column name="value"/>
      <sql>
        <![CDATA[
          select cid.compound as source_id, cid.id as value
          from apidbTuning.CompoundId cid
          where cid.type ='synonym'
        ]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="CompoundsFromMetabolicPathways">
      <column name="source_id"/>
      <column name="enzyme"/>
      <column name="substrates_text"/>
      <column name="products_text"/>
      <sql>
        <![CDATA[
           select distinct pc.chebi_accession as source_id, pr.enzyme,
                           pr.substrates_text, pr.products_text
           from apidbTuning.PathwayCompounds pc, apidbTuning.PathwayReactions pr
           where pc.reaction_id = pr.reaction_id
             and pc.ext_db_name = pr.ext_db_name
             and pc.ext_db_version = pr.ext_db_version
        ]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="PathwaysFromCompounds">
      <column name="source_id"/>
      <column name="pathway_source_id"/>
      <column name="pathway_name"/>
      <sql>
        <![CDATA[
          select distinct pc.chebi_accession as source_id,
                          pa.source_id as pathway_source_id,
                          pa.name as pathway_name, pa.pathway_source,
                          pr.reaction_source_id
          from apidbTuning.PathwayCompounds pc, apidbTuning.PathwayReactions pr,
               apidbTuning.PathwayAttributes pa
          where pc.pathway_id = pa.pathway_id
            and pr.reaction_id = pc.reaction_id
            and pc.chebi_accession is not null
        ]]>
      </sql>
    </sqlQuery>

  </querySet>


</wdkModel>
