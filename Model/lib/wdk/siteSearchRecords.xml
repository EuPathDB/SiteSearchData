<!--
    This is a special WDK model used to serve data to process that generates JSON files for Site Search.
    
    It follows very specific rules needed for successful production of that data.

Each record class must:
- have exactly one associated Question
- have an urlName that exactly matches the urlName of the parallel record class in ApiCommonModel
- include exactly one reporter, the SolrLoaderReporter
- have a displayName using sentence case
- have a <propertyList> with a "batch" property, indicating what type of batch that record class should be bundled with
- should have only <attributeQueryRef>s and <table>s

Each <attributeQueryRef> must:
- always and only include name and displayName.
- never have its name changed.  Doing so will invalidate strategies in the UserDB.  (They are used as parameter values)
- the displayName should use sentence case
- a few special attributes are labeled internal=true.  these serve special purposes in site search land, and are commented accordingly
- may include a <propertyList> for "isSummary" indicating that this field is used in the UI to briefly describe this record
- may include a <propertyList> for "boost" indicating a multiplier used to boost score of documents that match this field (default is 1)

Each <table> must follow the same rules as attributeQueryRefs, plus:
- the table's <columnAttribute>s should include only name.  (The user will never see their display name or help, etc)

Each Question must:
- have exactly zero or one parameters
- not bother with help (it would never been seen), and its displayName is irrelevant

 -->
<wdkModel>

  <questionSet name="Questions" displayName="dontcare">

    <question name="GenesByOrganism" displayName="dontcare"
              queryRef="GeneIdQueries.GenesByOrganismAbbrev"
              recordClassRef="recordClasses.gene">
    </question>

    <question name="EstsByOrganism" displayName="dontcare"
              queryRef="EstIdQueries.EstsByOrganismAbbrev"
              recordClassRef="recordClasses.est">
    </question>

    <question name="Pathways" displayName="dontcare"
              queryRef="PathwayIdQueries.AllPathways"
              recordClassRef="recordClasses.pathway">
    </question>

    <question name="Compounds" displayName="dontcare"
              queryRef="CompoundIdQueries.AllCompounds"
              recordClassRef="recordClasses.compound">
    </question>

    <question name="Datasets" displayName="dontcare"
              queryRef="DatasetIdQueries.AllDatasets"
              recordClassRef="recordClasses.dataset">
    </question>

    <question name="Organisms" displayName="dontcare"
              queryRef="OrganismIdQueries.Organisms"
              recordClassRef="recordClasses.organism">
    </question>

    <question name="Sequences" displayName="dontcare"
              queryRef="SequenceIdQueries.SequencesByOrganismAbbrev"
              recordClassRef="recordClasses.sequence">
    </question>

    <question name="PopsetIsolates" displayName="dontcare"
              queryRef="PopsetIds.PopsetByOrganismAbbrev"
              recordClassRef="recordClasses.PopsetRecordClass">
    </question>

  </questionSet>

  <recordClassSet name="recordClasses">

    <!-- ################################################################### -->
    <!-- ########################  Organism Record  ######################## -->
    <!-- ################################################################### -->

    <recordClass name="organism" urlName="organism" displayName="Organism">
      <propertyList name="batch">
        <value>dataset-presenter</value>
      </propertyList>

      <primaryKey aliasQueryRef="OrganismAttributes.OrganismAlias">
        <columnRef>source_id</columnRef>
      </primaryKey>

      <idAttribute name="primary_key" displayName="Organism ID">
        <text>
          <![CDATA[
                   $$source_id$$
          ]]>
        </text>
      </idAttribute>

      <reporter name="solrjson"
                displayName="solr json: choose from columns and/or tables"
                scopes=""
                implementation="org.eupathdb.sitesearch.data.model.report.SolrLoaderReporter"/>

      <attributeQueryRef ref="OrganismAttributes.organismAttrs">
        <columnAttribute name="species" displayName="Species"/>
        <columnAttribute name="organism" displayName="dontcare" internal="true"/>  <!-- special field for organism filtering -->
        <columnAttribute name="organism_full" displayName="Organism">
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>
        <columnAttribute name="data_source" displayName="Data source"/>

      </attributeQueryRef>

      <table name="GenomeSequencingAndAnnotationAttribution"
             displayName="Genome sequencing and annotation"
             queryRef="OrganismTables.GenomeSequencingAndAnnotation">
        <columnAttribute name="description"/>
      </table>

    </recordClass>

    <!-- ################################################################### -->
    <!-- ########################  Sequence Record  ######################## -->
    <!-- ################################################################### -->

    <recordClass name="sequence" urlName="genomic-sequence" displayName="Genomic sequence">
      <propertyList name="batch">
        <value>organism</value>
      </propertyList>

      <primaryKey aliasQueryRef="SequenceAttributes.SequenceAlias">
        <columnRef>source_id</columnRef>
      </primaryKey>

      <idAttribute name="primary_key" displayName="Sequence ID">
        <text>
          <![CDATA[
                   $$source_id$$
          ]]>
        </text>
      </idAttribute>

      <reporter name="solrjson"
                displayName="solr json: choose from columns and/or tables"
                scopes=""
                implementation="org.eupathdb.sitesearch.data.model.report.SolrLoaderReporter"/>

      <attributeQueryRef ref="SequenceAttributes.Bfmv">
        <columnAttribute name="description" displayName="Description">
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>
        <columnAttribute name="organism" displayName="dontcare" internal="true"/>  <!-- special field for organism filtering -->
        <columnAttribute name="organism_full" displayName="Organism">
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>
        <columnAttribute name="genbank_accession" displayName="GenBank"/>
      </attributeQueryRef>

      <table name="Aliases"
             displayName="Previous IDs and aliases"
             queryRef="SequenceTables.Aliases">
        <columnAttribute name="seq_id"/>
      </table>



    </recordClass>

    <!-- ################################################################### -->
    <!-- ########################  Pathway Record  ######################### -->
    <!-- ################################################################### -->

    <recordClass name="pathway" urlName="pathway" displayName="Metabolic pathway">
      <propertyList name="batch">
        <value>pathway</value>
      </propertyList>

      <primaryKey aliasQueryRef="PathwayAttributes.PathwayAlias">
        <columnRef>pathway_source</columnRef>
        <columnRef>source_id</columnRef>
      </primaryKey>

      <idAttribute name="primary_key" displayName="Pathway ID">
        <text>
          <![CDATA[
               $$source_id$$
          ]]>
        </text>
      </idAttribute>

      <textAttribute name="pathway_source_text" displayName="Pathway source">
        <text>
          <![CDATA[
               $$pathway_source$$
          ]]>
        </text>
      </textAttribute>

      <reporter name="solrjson"
                displayName="solr json: choose from columns and/or tables"
                scopes=""
                implementation="org.eupathdb.sitesearch.data.model.report.SolrLoaderReporter"/>

      <attributeQueryRef ref="PathwayAttributes.Bfmv">
        <columnAttribute name="project" displayName="dontcare" internal="true"/>  <!-- special field for project filtering -->
        <columnAttribute name="name" displayName="Pathway">
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>
      </attributeQueryRef>

      <table name="CompoundsMetabolicPathways"
             displayName="Reactions"
             queryRef="PathwayTables.CompoundsFromMetabolicPathways" >
        <columnAttribute name="ec_number"/>
        <columnAttribute name="enzyme_description"/>
        <columnAttribute name="substrates_text"/>
        <columnAttribute name="products_text"/>
      </table>

      <table name="PathwayGenes"
             displayName="Genes"
             queryRef="PathwayTables.PathwayGenes" >
        <columnAttribute name="source_id"/>
        <columnAttribute name="pathway_source"/>
        <columnAttribute name="gene_source_id"/>
        <columnAttribute name="name"/>
        <columnAttribute name="product"/>
      </table>

    </recordClass>

    <!-- ################################################################### -->
    <!-- ########################  Compound Record  ######################## -->
    <!-- ################################################################### -->

    <recordClass name="compound" urlName="compound" displayName="Compound">
      <propertyList name="batch">
        <value>compound</value>
      </propertyList>

      <primaryKey aliasQueryRef="CompoundAttributes.CompoundAlias">
        <columnRef>source_id</columnRef>
      </primaryKey>

      <idAttribute name="primary_key" displayName="ChEBI ID">
        <text>
          <![CDATA[
                   $$source_id$$
          ]]>
        </text>
      </idAttribute>

      <reporter name="solrjson"
                displayName="solr json: choose from columns and/or tables"
                scopes=""
                implementation="org.eupathdb.sitesearch.data.model.report.SolrLoaderReporter"/>

      <attributeQueryRef ref="CompoundAttributes.Bfmv">
        <columnAttribute name="project" displayName="dontcare" internal="true"/>  <!-- special field for project filtering -->
        <columnAttribute name="definition" displayName="Definition" >
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>
        <columnAttribute name="formula" displayName="Molecular formula"/>
        <columnAttribute name="compound_name" displayName="Name" >
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>
        <columnAttribute name="secondary_ids"  displayName="Secondary ChEBI IDs"/>  <!-- THIS SHOULD BE IN A MULTI-ROW TABLE? -->
      </attributeQueryRef>

      <attributeQueryRef ref="CompoundAttributes.Synonyms" >
        <columnAttribute name="synonyms" displayName="Synonyms"/>
      </attributeQueryRef>

      <table name="Properties" displayName="Properties"
             queryRef="CompoundTables.Properties">
        <columnAttribute name="value"/>
      </table>

      <table name="IupacNames" displayName="IUPAC names"
             queryRef="CompoundTables.IupacNames">
        <columnAttribute name="value"/>
      </table>

      <table name="Synonyms" displayName="Synonyms"
             queryRef="CompoundTables.Synonyms">
        <columnAttribute name="value"/>
      </table>

      <table name="CompoundsMetabolicPathways"
             displayName="Metabolic pathway reactions"
             queryRef="CompoundTables.CompoundsFromMetabolicPathways">

        <columnAttribute name="substrates_text"/>
        <columnAttribute name="products_text"/>
        <columnAttribute name="ec_number"/>
        <columnAttribute name="enzyme_description"/>
        <columnAttribute name="compound_source_id"/>
        <columnAttribute name="chebi_accession"/>
      </table>

      <table name="PathwaysFromCompounds"
             displayName="Metabolic pathways"
             queryRef="CompoundTables.PathwaysFromCompounds">
        <columnAttribute name="pathway_name"/>
      </table>

      <table name="Genes" displayName="Genes"
             queryRef="CompoundTables.Genes">
        <columnAttribute name="gene_source_id"/>
        <columnAttribute name="product"/>
        <columnAttribute name="gene_name"/>
      </table>

    </recordClass>

    <!-- ################################################################### -->
    <!-- ###########################  EST Record  ########################## -->
    <!-- ################################################################### -->

    <recordClass name="est" urlName="est" displayName="EST">
      <propertyList name="batch">
        <value>organism</value>
      </propertyList>

      <primaryKey aliasQueryRef="EstTableQueries.EstAlias">
        <columnRef>source_id</columnRef>
      </primaryKey>

      <idAttribute name="primary_key" displayName="EST ID">
        <text>
          <![CDATA[
                   $$source_id$$
          ]]>
        </text>
      </idAttribute>

      <reporter name="solrjson"
                displayName="solr json: choose from columns and/or tables"
                scopes=""
                implementation="org.eupathdb.sitesearch.data.model.report.SolrLoaderReporter"/>

      <attributeQueryRef ref="EstAttributeQueries.Bfmv">
        <columnAttribute name="dbest_name" displayName="Library">
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>
        <columnAttribute name="vector" displayName="Vector"/>
        <columnAttribute name="stage"  displayName="Stage"/>
        <columnAttribute name="organism" displayName="Organism" >
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>
      </attributeQueryRef>

      <table name="ReferenceInfo" displayName="Reference" queryRef="EstTableQueries.Reference">
        <columnAttribute name="author" displayName="Author"/>
        <columnAttribute name="affiliation" displayName="Affiliation"/>
      </table>
    </recordClass>

    <!-- ################################################################### -->
    <!-- ##########################  Gene Record  ########################## -->
    <!-- ################################################################### -->

    <recordClass name="gene" urlName="gene">

      <propertyList name="batch">
        <value>organism</value>
      </propertyList>

      <primaryKey aliasQueryRef="GeneAttributes.GeneAlias">
        <columnRef>source_id</columnRef>
      </primaryKey>

      <idAttribute name="primary_key"
                   displayName="Gene ID"
                   attributeCategory="deep">
        <text>
          <![CDATA[
                   $$source_id$$
          ]]>
        </text>
      </idAttribute>

      <reporter name="solrjson"  displayName="solr json: choose from columns and/or tables" scopes=""
                implementation="org.eupathdb.sitesearch.data.model.report.SolrLoaderReporter"/>

      <attributeQueryRef ref="GeneAttributes.Bfmv">
        <columnAttribute displayName="Genomic sequence ID" name="sequence_id"/>

        <columnAttribute name="product" displayName="Product description" >
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>

        <columnAttribute name="gene_type" displayName="Gene type"/>
        <columnAttribute name="name" displayName="Gene name or symbol">
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>
        <columnAttribute name="organism" displayName="dontcare" internal="true"/>  <!-- special field for organism filtering -->
        <columnAttribute name="organism_full" displayName="Organism" >
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>
        <columnAttribute name="genus_species" displayName="Species"/>
        <columnAttribute name="strain" displayName="Strain"/>
        <columnAttribute name="orthomcl_name" displayName="Ortholog group"/>
      </attributeQueryRef>

      <table name="GeneTranscripts"
             displayName="Transcripts"
             queryRef="GeneTables.GeneTranscripts">
        <columnAttribute name="transcript_id"/>
      </table>

      <table name="InterPro"
             displayName="InterPro domains"
             queryRef="GeneTables.InterPro">
        <columnAttribute name="interpro_name"/>
        <columnAttribute name="interpro_family_id"/>
        <columnAttribute name="interpro_primary_id"/>
        <columnAttribute name="interpro_secondary_id"/>
        <columnAttribute name="interpro_desc"/>
      </table>

      <table name="Notes"
             displayName="Notes from snnotators"
             queryRef="GeneTables.Notes">
        <columnAttribute name="comment_string"/>
      </table>

      <!-- needed for the user comment updater. -->
      <table name="userCommentIds"
             internal="true"
             queryRef="GeneTables.UserCommentIDs">
        <columnAttribute displayName="Comment ID" name="comment_id"/>
      </table>

      <table name="UserCommentContent"
             displayName="User comments"
             queryRef="GeneTables.UserCommentContent">
        <columnAttribute name="content"/>
      </table>

      <table name="ECNumbers"
             displayName="EC numbers"
             queryRef="GeneTables.ECNumbers">
        <columnAttribute name="ec_number"/>
        <columnAttribute name="ec_description"/>
      </table>

      <table name="GOTerms"
             displayName="GO terms"
             queryRef="GeneTables.GOTerms">
        <columnAttribute name="go_id"/>
        <columnAttribute name="go_term_name"/>
        <columnAttribute name="reference"/>
      </table>

      <table name="MetabolicPathways"
             displayName="Metabolic pathways"
             queryRef="GeneTables.MetabolicPathways">
        <columnAttribute name="pathway_source_id"/>
        <columnAttribute name="pathway_name"/>
      </table>

      <table name="Alias"
             displayName="Names, IDs, and aliases"
             queryRef="GeneTables.Alias">
        <columnAttribute name="alias"/>
        <columnAttribute name="id_type"/>
      </table>

      <table name="PubMed"
             displayName="PubMed"
             queryRef="GeneTables.PubMed">
        <columnAttribute name="pubmed_id"/>
        <columnAttribute name="doi"/>
        <columnAttribute name="title"/>
        <columnAttribute name="authors"/>
      </table>

      <table name="GeneLinkouts"
             displayName="External links"
             queryRef="GeneTables.gene_dbrefs">
        <columnAttribute name="ext_id"/>
      </table>

      <table name="PdbSimilarities"
             displayName="PDB chains"
             queryRef="GeneTables.PdbSimilarities">
        <columnAttribute name="pdb_chain"/>
        <columnAttribute name="pdb_id"/>
        <columnAttribute name="pdb_title"/>
      </table>

      <table name="Epitopes"
             displayName="Epitopes from IEDB"
             queryRef="GeneTables.Epitopes">
        <columnAttribute name="iedb_id"  displayName="Epitope"/>
      </table>

      <table name="PreferredProducts"
             displayName="Annotated product descriptions"
             queryRef="GeneTables.PreferredProducts">
        <columnAttribute name="product"/>
        <columnAttribute name="reference"/>
      </table>

    </recordClass>

    <!-- ################################################################### -->
    <!-- #########################  Dataset Record  ######################## -->
    <!-- ################################################################### -->

    <recordClass name="dataset" urlName="dataset" displayName="Dataset">
      <propertyList name="batch">
        <value>dataset-presenter</value>
      </propertyList>

      <primaryKey aliasPluginClassName="org.gusdb.wdk.model.record.GenericRecordPrimaryKeyAliasPlugin">
        <columnRef>dataset_id</columnRef>
      </primaryKey>

      <idAttribute name="primary_key" displayName="Data Set">
        <text>
          <![CDATA[ $$display_name$$ ]]>
        </text>
      </idAttribute>

      <reporter name="solrjson"
                displayName="solr json: choose from columns and/or tables"
                scopes=""
                implementation="org.eupathdb.sitesearch.data.model.report.SolrLoaderReporter"/>

      <attributeQueryRef ref="DatasetAttributes.All">
        <columnAttribute name="display_name" displayName="Dataset Name">
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>
        <columnAttribute name="description" displayName="Description"/>
        <columnAttribute name="acknowledgement"/>
        <columnAttribute name="summary" displayName="Summary">
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>
        <columnAttribute name="newcategory" displayName="Category"/>
      </attributeQueryRef>

      <table name="Contacts"
             displayName="Principal Investigator and Collaborators"
             queryRef="DatasetTables.Contacts">
        <columnAttribute name="dataset_id"/>
        <columnAttribute name="contact_name" displayName="Investigator"/>
        <columnAttribute name="affiliation" displayName="Affiliation"/>
      </table>

      <table name="Publications"
             displayName="Associated Publications"
             queryRef="DatasetTables.Publications">
        <columnAttribute name="dataset_id"/>
        <columnAttribute name="pmid" displayName="Pubmed ID"/>
        <columnAttribute name="citation"/>
      </table>

    </recordClass>

    <!-- ################################################################### -->
    <!-- #########################  Popset Record  ######################### -->
    <!-- ################################################################### -->

    <recordClass name="PopsetRecordClass" urlName="popsetSequence" displayName="Popset isolate sequence">
      <propertyList name="batch">
        <value>organism</value>
      </propertyList>

      <primaryKey aliasQueryRef="PopsetAttributes.PopsetAlias">
        <columnRef>source_id</columnRef>
      </primaryKey>

      <idAttribute name="primary_key" displayName="Popset ID">
        <text>
          <![CDATA[
                   $$source_id$$
          ]]>
        </text>
      </idAttribute>

      <reporter name="solrjson"
                displayName="solr json: choose from columns and/or tables"
                scopes=""
                implementation="org.eupathdb.sitesearch.data.model.report.SolrLoaderReporter"/>

      <attributeQueryRef ref="PopsetAttributes.Attributes">
        <columnAttribute name="organism" displayName="Organism" />
        <columnAttribute name="description" displayName="Description">
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>
        <columnAttribute name="isolation_source" displayName="Isolation source"/>
        <columnAttribute name="curated_isolation_source" displayName="Curated isolation source"/>
        <columnAttribute name="note" displayName="Note"/>
        <columnAttribute name="gene_name" displayName="Gene name"/>
        <columnAttribute name="product" displayName="Product">
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>
        <columnAttribute name="geographic_location" displayName="Geographic location">
          <propertyList name="isSummary">
            <value>true</value>
          </propertyList>
        </columnAttribute>
        <columnAttribute name="curated_geographic_location" displayName="Curated geographic location"/>
        <columnAttribute name="specific_host" displayName="Host"/>
        <columnAttribute name="popset" displayName="Popset"/>
        <columnAttribute name="strain" displayName="Strain"/>
      </attributeQueryRef>

    </recordClass>

  </recordClassSet>

</wdkModel>
