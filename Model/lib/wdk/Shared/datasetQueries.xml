<wdkModel>

  <querySet name="DatasetIdQueries" queryType="id" isCacheable="true">
    <sqlQuery name="AllDatasets">
      <column name="dataset_id"/>
      <sql>
        <![CDATA[
          select dataset_presenter_id as dataset_id
          from apidbTuning.DatasetPresenter
          where category is null OR category != 'Link outs'
        ]]>
      </sql>
    </sqlQuery>
  </querySet>

  <querySet name="DatasetAttributes" queryType="attribute" isCacheable="false">
    <sqlQuery name="All">
      <column name="hyperlinkName"/>
      <column name="dataset_id"/>
      <column name="display_name"/>
      <column name="project"/>
      <column name="description"/>
      <column name="summary"/>
      <column name="acknowledgement"/>
      <column name="newcategory"/>
      <sql>
        <![CDATA[
          select dataset_presenter_id as dataset_id, '@PROJECT_ID@' as project,
                 display_name, display_name as hyperlinkName, description, summary, acknowledgement,
                 nvl(display_category, category) as newcategory
          from apidbTuning.DatasetPresenter
        ]]>
      </sql>
    </sqlQuery>

  </querySet>

  <querySet name="DatasetTables" queryType="table" isCacheable="false">

    <sqlQuery name="Contacts">
      <column name="dataset_id"/>
      <column name="contact_name"/>
      <column name="affiliation"/>
      <sql>
        <![CDATA[
          select dataset_presenter_id as dataset_id,
                 name as contact_name, affiliation
          from apidbTuning.DatasetContact
        ]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="Publications">
      <column name="dataset_id"/>
      <column name="pmid"/>
      <column name="citation"/>
      <sql>
        <![CDATA[
          select dataset_presenter_id as dataset_id, 'PMID:' || pmid as pmid, citation
          from apidbTuning.DatasetPublication
          where pmid is not null
        ]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="Organisms"  isCacheable='false'>
      <column name="dataset_id"/>
      <column name="organism"/>
      <sql>
        <![CDATA[
          select dnt.dataset_presenter_id as dataset_id, tn.name as organism
          from apidbTuning.DatasetNameTaxon dnt, sres.TaxonName tn
          where dnt.taxon_id = tn.taxon_id
            and tn.name_class = 'scientific name'
        ]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="AttributeValues"  isCacheable='false'>
      <column name="dataset_id"/>
      <column name="value"/>
      <sql>
        <![CDATA[
          select distinct sd.dataset_id, av.string_value as value
          from eda.AttributeValue av, eda.EntityTypeGraph etg, apidbTuning.StudyIdDatasetId sd
          where av.entity_type_id = etg.entity_type_id
            and etg.study_stable_id = sd.study_stable_id
            and av.number_value is null
            and av.date_value is null
            and lower(av.string_value) != 'yes'
            and lower(av.string_value) != 'no'
        ]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="AttributeNames"  isCacheable='false'>
      <column name="dataset_id"/>
      <column name="name"/>
      <sql>
        <![CDATA[
          select distinct sd.dataset_id, ag.display_name, ag.provider_label
          from eda.AttributeGraph ag, eda.Attribute a, eda.EntityTypeGraph etg, apidbTuning.StudyIdDatasetId sd
          where ag.stable_id = a.stable_id
            and a.entity_type_id = etg.entity_type_id
            and etg.study_stable_id = sd.study_stable_id
        ]]>
      </sql>
    </sqlQuery>

  </querySet>

</wdkModel>
